generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated"
}

datasource db {
  provider = "postgresql"
}

model Watchlist {
  id        String   @id @default(cuid())
  userId    String
  produkId  String
  createdAt DateTime @default(now())
  produk    Produk   @relation(fields: [produkId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, produkId])
}

model Setting {
  key   String @id
  value String
}

model User {
  id            String         @id @default(cuid())
  name          String
  email         String         @unique
  password      String
  role          String         @default("masyarakat")
  createdAt     DateTime       @default(now())
  address       String?
  phone         String?
  bids          Bid[]
  notifications Notification[]
  transactions  Transaction[]
  watchlists    Watchlist[]
}

model Transaction {
  id        String   @id @default(cuid())
  userId    String
  amount    Int
  status    String   @default("pending")
  type      String
  snapToken String?
  orderId   String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String
  isRead    Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Produk {
  id             String      @id @default(cuid())
  nama_barang    String
  tanggal        DateTime
  harga_awal     Int
  deskripsi      String
  createdAt      DateTime    @default(now())
  image_url      String?
  jumlah_seat    Int?
  kilometer      Int?
  merk_mobil     String?
  tahun          Int?
  tipe_mobil     String?
  transmisi      String?
  images         String[]
  interior       String?
  mesin          String?
  riwayat_servis String?
  kategori       Kategori    @default(SEMUA)
  lokasi_mobil   String?
  bids           Bid[]
  watchlists     Watchlist[]
}

model Bid {
  id            String   @id @default(cuid())
  userId        String
  produkId      String
  bidAmount     Int
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  paymentStatus String   @default("unpaid")
  produk        Produk   @relation(fields: [produkId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Kategori {
  SEMUA
  RAMAI
  SEGERA
  BARU
  DIBAWAH100
}
